/**
 * Moon Phases Service
 * –†–∞—Å—á—ë—Ç —Ñ–∞–∑ –õ—É–Ω—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
 */

class MoonPhasesService {
  /**
   * –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ñ–∞–∑—É –õ—É–Ω—ã –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–π –¥–∞—Ç—ã
   * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–∏–Ω–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –º–µ—Å—è—Ü–∞ (29.53 –¥–Ω—è)
   */
  calculateMoonPhase(date = new Date()) {
    const _year = date.getFullYear();
    const _month = date.getMonth() + 1;
    const _day = date.getDate();

    // –ò–∑–≤–µ—Å—Ç–Ω–æ–µ –Ω–æ–≤–æ–ª—É–Ω–∏–µ: 6 —è–Ω–≤–∞—Ä—è 2000, 18:14 UTC
    const knownNewMoon = new Date(2000, 0, 6, 18, 14, 0);
    const synodicMonth = 29.530588853; // –°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ –ª—É–Ω–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞ –≤ –¥–Ω—è—Ö

    // –í—ã—á–∏—Å–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π —Å –∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ –Ω–æ–≤–æ–ª—É–Ω–∏—è
    const daysSinceKnownNewMoon = (date - knownNewMoon) / (1000 * 60 * 60 * 24);

    // –í—ã—á–∏—Å–ª—è–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –≤ –ª—É–Ω–Ω–æ–º —Ü–∏–∫–ª–µ (0-1)
    const currentPhase = (daysSinceKnownNewMoon % synodicMonth) / synodicMonth;

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–∑—ã –∏ –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Å–≤–µ—â—ë–Ω–Ω–æ—Å—Ç–∏
    let phaseName, illumination, emoji, description, energy;

    if (currentPhase < 0.033 || currentPhase >= 0.967) {
      phaseName = '–ù–æ–≤–æ–ª—É–Ω–∏–µ';
      emoji = 'üåë';
      illumination = 0;
      description = '–í—Ä–µ–º—è –Ω–æ–≤—ã—Ö –Ω–∞—á–∏–Ω–∞–Ω–∏–π –∏ –ø–æ—Å–µ–≤–∞ —Å–µ–º—è–Ω –±—É–¥—É—â–µ–≥–æ';
      energy = '–ù–∞—á–∞–ª–æ —Ü–∏–∫–ª–∞, –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ä–∞–±–æ—Ç–∞, –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏–π';
    } else if (currentPhase < 0.217) {
      phaseName = '–†–∞—Å—Ç—É—â–∏–π —Å–µ—Ä–ø';
      emoji = 'üåí';
      illumination = Math.round(currentPhase * 400);
      description = '–í—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏–π –∏ –¥–≤–∏–∂–µ–Ω–∏—è –≤–ø–µ—Ä—ë–¥';
      energy = '–†–æ—Å—Ç, —Ä–∞–∑–≤–∏—Ç–∏–µ, –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è';
    } else if (currentPhase < 0.283) {
      phaseName = '–ü–µ—Ä–≤–∞—è —á–µ—Ç–≤–µ—Ä—Ç—å';
      emoji = 'üåì';
      illumination = 50;
      description = '–ü—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π';
      energy = '–í—ã–∑–æ–≤—ã, —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –±–∞–ª–∞–Ω—Å';
    } else if (currentPhase < 0.467) {
      phaseName = '–†–∞—Å—Ç—É—â–∞—è –õ—É–Ω–∞';
      emoji = 'üåî';
      illumination = Math.round(currentPhase * 200);
      description = '–í—Ä–µ–º—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏';
      energy = '–ö—É–ª—å–º–∏–Ω–∞—Ü–∏—è —É—Å–∏–ª–∏–π, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, —ç–∫—Å–ø–∞–Ω—Å–∏—è';
    } else if (currentPhase < 0.533) {
      phaseName = '–ü–æ–ª–Ω–æ–ª—É–Ω–∏–µ';
      emoji = 'üåï';
      illumination = 100;
      description = '–ü–∏–∫ —ç–Ω–µ—Ä–≥–∏–∏, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏ –æ–∑–∞—Ä–µ–Ω–∏–µ';
      energy = '–ú–∞–∫—Å–∏–º—É–º —Å–∏–ª—ã, –æ—Å–æ–∑–Ω–∞–Ω–∏–µ, –ø—Ä–∞–∑–¥–Ω–æ–≤–∞–Ω–∏–µ';
    } else if (currentPhase < 0.717) {
      phaseName = '–£–±—ã–≤–∞—é—â–∞—è –õ—É–Ω–∞';
      emoji = 'üåñ';
      illumination = Math.round((1 - currentPhase) * 200);
      description = '–í—Ä–µ–º—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –∏ –æ—á–∏—â–µ–Ω–∏—è';
      energy = '–û—Ç–ø—É—Å–∫–∞–Ω–∏–µ, –æ—á–∏—â–µ–Ω–∏–µ, –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å';
    } else if (currentPhase < 0.783) {
      phaseName = '–ü–æ—Å–ª–µ–¥–Ω—è—è —á–µ—Ç–≤–µ—Ä—Ç—å';
      emoji = 'üåó';
      illumination = 50;
      description = '–ü–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤ –∏ –ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞';
      energy = '–†–µ—Ñ–ª–µ–∫—Å–∏—è, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ, –º—É–¥—Ä–æ—Å—Ç—å';
    } else {
      phaseName = '–£–±—ã–≤–∞—é—â–∏–π —Å–µ—Ä–ø';
      emoji = 'üåò';
      illumination = Math.round((1 - currentPhase) * 400);
      description = '–í—Ä–µ–º—è –æ—Ç–¥—ã—Ö–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –Ω–æ–≤–æ–º—É —Ü–∏–∫–ª—É';
      energy = '–û—Ç–¥—ã—Ö, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ, –∏–Ω—Ç—Ä–æ—Å–ø–µ–∫—Ü–∏—è';
    }

    return {
      phaseName,
      emoji,
      illumination,
      phaseValue: currentPhase,
      description,
      energy,
      date: date.toISOString(),
      recommendations: this.getRecommendations(phaseName)
    };
  }

  /**
   * –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Ñ–∞–∑—ã –õ—É–Ω—ã
   */
  getRecommendations(phaseName) {
    const recommendations = {
      '–ù–æ–≤–æ–ª—É–Ω–∏–µ': {
        tarot: 'üåü –û—Ç–ª–∏—á–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —Ä–∞—Å–∫–ª–∞–¥–æ–≤ –Ω–∞ –Ω–æ–≤—ã–µ –Ω–∞—á–∏–Ω–∞–Ω–∏—è –∏ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫—É –Ω–∞–º–µ—Ä–µ–Ω–∏–π',
        general: [
          '–°—Ç–∞–≤—å—Ç–µ —Ü–µ–ª–∏ –∏ –Ω–∞–º–µ—Ä–µ–Ω–∏—è –Ω–∞ –Ω–æ–≤—ã–π –ª—É–Ω–Ω—ã–π —Ü–∏–∫–ª',
          '–ú–µ–¥–∏—Ç–∏—Ä—É–π—Ç–µ –∏ —Ä–∞–±–æ—Ç–∞–π—Ç–µ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π',
          '–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã',
          '–ò–∑–±–µ–≥–∞–π—Ç–µ –≤–∞–∂–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π - –¥–∞–π—Ç–µ –∏–¥–µ—è–º —Å–æ–∑—Ä–µ—Ç—å'
        ],
        energy: 'low',
        color: '#1a1a2e',
        crystals: ['–õ–∞–±—Ä–∞–¥–æ—Ä–∏—Ç', '–ß—ë—Ä–Ω—ã–π —Ç—É—Ä–º–∞–ª–∏–Ω', '–û–±—Å–∏–¥–∏–∞–Ω', '–õ—É–Ω–Ω—ã–π –∫–∞–º–µ–Ω—å'],
        rituals: ['–ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π –Ω–∞ –±—É–º–∞–≥–µ', '–°–æ–∑–¥–∞–Ω–∏–µ –¥–æ—Å–∫–∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏', '–†–∏—Ç—É–∞–ª –æ—á–∏—â–µ–Ω–∏—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞', '–ó–∞–∂–∂–µ–Ω–∏–µ —á—ë—Ä–Ω–æ–π —Å–≤–µ—á–∏'],
        bestActivities: ['–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ', '–ú–µ–¥–∏—Ç–∞—Ü–∏—è', '–í–µ–¥–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞', '–û—Ç–¥—ã—Ö –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ'],
        avoid: ['–ù–∞—á–∞–ª–æ –∫—Ä—É–ø–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤', '–í–∞–∂–Ω—ã–µ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã', '–•–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏', '–°—Ç—Ä–∏–∂–∫–∞ –≤–æ–ª–æ—Å'],
        affirmation: '–Ø –æ—Ç–∫—Ä—ã—Ç(–∞) –Ω–æ–≤—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º –∏ —Å–µ—é —Å–µ–º–µ–Ω–∞ —Å–≤–æ–∏—Ö –∂–µ–ª–∞–Ω–∏–π'
      },
      '–†–∞—Å—Ç—É—â–∏–π —Å–µ—Ä–ø': {
        tarot: '‚ú® –•–æ—Ä–æ—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è —Ä–∞—Å–∫–ª–∞–¥–æ–≤ –æ –¥–µ–π—Å—Ç–≤–∏—è—Ö –∏ –ø–µ—Ä–≤—ã—Ö —à–∞–≥–∞—Ö',
        general: [
          '–ù–∞—á–∏–Ω–∞–π—Ç–µ –Ω–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã',
          '–ü—Ä–∏–Ω–∏–º–∞–π—Ç–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è',
          '–£—á–∏—Ç–µ—Å—å –Ω–æ–≤–æ–º—É',
          '–ü—Ä–æ—è–≤–ª—è–π—Ç–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É'
        ],
        energy: 'medium',
        color: '#16213e',
        crystals: ['–ö–∞—Ä–Ω–µ–ª–∏–∞–Ω', '–¶–∏—Ç—Ä–∏–Ω', '–¢–∏–≥—Ä–æ–≤—ã–π –≥–ª–∞–∑', '–ó–µ–ª—ë–Ω—ã–π –∞–≤–∞–Ω—Ç—é—Ä–∏–Ω'],
        rituals: ['–°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –¥–µ–π—Å—Ç–≤–∏–π', '–†–∏—Ç—É–∞–ª –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –∏–∑–æ–±–∏–ª–∏—è', '–†–∞–±–æ—Ç–∞ —Å –Ω–∞–º–µ—Ä–µ–Ω–∏—è–º–∏', '–ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ —Ö–æ–±–±–∏'],
        bestActivities: ['–ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤', '–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–æ–≤', '–ù–∞—á–∞–ª–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫', '–û–±—É—á–µ–Ω–∏–µ'],
        avoid: ['–°–æ–º–Ω–µ–Ω–∏—è –∏ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–Ω–∏–µ', '–ü–∞—Å—Å–∏–≤–Ω–æ—Å—Ç—å', '–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–µ–ª'],
        affirmation: '–Ø –∞–∫—Ç–∏–≤–Ω–æ —Å–æ–∑–¥–∞—é —Å–≤–æ—é —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å, —à–∞–≥ –∑–∞ —à–∞–≥–æ–º'
      },
      '–ü–µ—Ä–≤–∞—è —á–µ—Ç–≤–µ—Ä—Ç—å': {
        tarot: '‚ö° –†–∞—Å–∫–ª–∞–¥—ã –Ω–∞ –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –æ—Å–æ–±–µ–Ω–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã',
        general: [
          '–ü—Ä–µ–æ–¥–æ–ª–µ–≤–∞–π—Ç–µ –≤—ã–∑–æ–≤—ã —Å —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é',
          '–ü—Ä–∏–Ω–∏–º–∞–π—Ç–µ –≤–∞–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è',
          '–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π—Ç–µ –ø–ª–∞–Ω—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏',
          '–ü—Ä–æ—è–≤–ª—è–π—Ç–µ —É–ø–æ—Ä—Å—Ç–≤–æ'
        ],
        energy: 'high',
        color: '#0f3460',
        crystals: ['–ö—Ä–∞—Å–Ω—ã–π —è—à–º–∞', '–ì–µ–º–∞—Ç–∏—Ç', '–ß—ë—Ä–Ω—ã–π –æ–Ω–∏–∫—Å', '–ü–∏—Ä–∏—Ç'],
        rituals: ['–†–∏—Ç—É–∞–ª –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏—è –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π', '–ú–µ–¥–∏—Ç–∞—Ü–∏—è –Ω–∞ —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å', '–†–∞–±–æ—Ç–∞ —Å–æ —Å—Ç—Ä–∞—Ö–∞–º–∏', '–°–∂–∏–≥–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π'],
        bestActivities: ['–ü—Ä–∏–Ω—è—Ç–∏–µ —Å–ª–æ–∂–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π', '–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã', '–†–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤', '–ü—Ä–æ—è–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏'],
        avoid: ['–ò–∑–±–µ–≥–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º', '–û—Ç–∫–ª–∞–¥—ã–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏–π', '–°–¥–∞—á–∞ –ø–æ–∑–∏—Ü–∏–π'],
        affirmation: '–Ø –ø—Ä–µ–æ–¥–æ–ª–µ–≤–∞—é –ª—é–±—ã–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è —Å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é –∏ —Å–∏–ª–æ–π'
      },
      '–†–∞—Å—Ç—É—â–∞—è –õ—É–Ω–∞': {
        tarot: 'üöÄ –í—Ä–µ–º—è –¥–ª—è –∞–º–±–∏—Ü–∏–æ–∑–Ω—ã—Ö —Ä–∞—Å–∫–ª–∞–¥–æ–≤ –∏ –±–æ–ª—å—à–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤',
        general: [
          '–ú–∞–∫—Å–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —É—Å–∏–ª–∏—è',
          '–†–∞–∑–≤–∏–≤–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç—ã',
          '–°—Ç—Ä–æ–∏—Ç–µ —Å–≤—è–∑–∏ –∏ –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–∞',
          '–ë—É–¥—å—Ç–µ —Å–æ—Ü–∏–∞–ª—å–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã'
        ],
        energy: 'very-high',
        color: '#e94560',
        crystals: ['–¶–∏—Ç—Ä–∏–Ω', '–°–æ–ª–Ω–µ—á–Ω—ã–π –∫–∞–º–µ–Ω—å', '–ü–∏—Ä–∏—Ç', '–ó–æ–ª–æ—Ç–∏—Å—Ç—ã–π —Ç–æ–ø–∞–∑'],
        rituals: ['–†–∏—Ç—É–∞–ª –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è —É—Å–ø–µ—Ö–∞', '–ú–∞–≥–∏—è –∏–∑–æ–±–∏–ª–∏—è', '–†–∞–±–æ—Ç–∞ —Å –¥–µ–Ω–µ–∂–Ω—ã–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏', '–£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π'],
        bestActivities: ['–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤', 'Networking', '–ü—É–±–ª–∏—á–Ω—ã–µ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è', '–ü—Ä–æ–¥–∞–∂–∏'],
        avoid: ['–£–µ–¥–∏–Ω–µ–Ω–∏–µ', '–ü–∞—Å—Å–∏–≤–Ω–æ—Å—Ç—å', '–°–æ–º–Ω–µ–Ω–∏—è –≤ —Å–µ–±–µ'],
        affirmation: '–ú–æ—è —ç–Ω–µ—Ä–≥–∏—è —Ä–∞—Å—Ç—ë—Ç, –∏ —è –ø—Ä–∏–≤–ª–µ–∫–∞—é –≤—Å—ë –ª—É—á—à–µ–µ –≤ —Å–≤–æ—é –∂–∏–∑–Ω—å'
      },
      '–ü–æ–ª–Ω–æ–ª—É–Ω–∏–µ': {
        tarot: 'üîÆ –õ–£–ß–®–ï–ï –≤—Ä–µ–º—è –¥–ª—è —Ä–∞—Å–∫–ª–∞–¥–æ–≤! –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –∏ —è—Å–Ω–æ—Å—Ç—å',
        general: [
          '–ó–∞–≤–µ—Ä—à–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç—ã',
          '–ü—Ä–∞–∑–¥–Ω—É–π—Ç–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è',
          '–ü—Ä–æ–≤–æ–¥–∏—Ç–µ —Ä–∏—Ç—É–∞–ª—ã –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏',
          '–û–±—Ä–∞—â–∞–π—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∑–Ω–∞–∫–∏ –∏ —Å–Ω—ã',
          '–û—Å–æ–±–µ–Ω–Ω–æ –º–æ—â–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –º–∞–≥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫'
        ],
        energy: 'maximum',
        color: '#f7b731',
        crystals: ['–õ—É–Ω–Ω—ã–π –∫–∞–º–µ–Ω—å', '–°–µ–ª–µ–Ω–∏—Ç', '–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π –∫–≤–∞—Ä—Ü', '–û–ø–∞–ª'],
        rituals: ['–ó–∞—Ä—è–¥–∫–∞ –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤ –Ω–∞ –ª—É–Ω–Ω–æ–º —Å–≤–µ—Ç–µ', '–†–∏—Ç—É–∞–ª –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏', '–õ—É–Ω–Ω—ã–µ –≤–∞–Ω–Ω—ã', '–ú–µ–¥–∏—Ç–∞—Ü–∏—è –ø–æ–¥ –ª—É–Ω–æ–π', '–ú–∞–≥–∏—á–µ—Å–∫–∏–µ —Ü–µ—Ä–µ–º–æ–Ω–∏–∏'],
        bestActivities: ['–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–µ–ª', '–ü—Ä–∞–∑–¥–Ω–∏–∫–∏', '–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã', '–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ', '–ì–∞–¥–∞–Ω–∏—è –∏ —Ä–∞—Å–∫–ª–∞–¥—ã –¢–∞—Ä–æ'],
        avoid: ['–ù–∞—á–∞–ª–æ –Ω–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤', '–í–∞–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –Ω–∞ —ç–º–æ—Ü–∏—è—Ö', '–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã', '–•–∏—Ä—É—Ä–≥–∏—è'],
        affirmation: '–Ø –≤ –ø–æ–ª–Ω–æ–π —Å–∏–ª–µ –∏ –ø—Ä–∞–∑–¥–Ω—É—é —Å–≤–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è'
      },
      '–£–±—ã–≤–∞—é—â–∞—è –õ—É–Ω–∞': {
        tarot: 'üåô –†–∞—Å–∫–ª–∞–¥—ã –Ω–∞ –æ—Ç–ø—É—Å–∫–∞–Ω–∏–µ –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –Ω–∞–∏–±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã',
        general: [
          '–û—Ç–ø—É—Å–∫–∞–π—Ç–µ –Ω–µ–Ω—É–∂–Ω–æ–µ',
          '–û—á–∏—â–∞–π—Ç–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ',
          '–ò–∑–±–∞–≤–ª—è–π—Ç–µ—Å—å –æ—Ç –≤—Ä–µ–¥–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫',
          '–ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –ø—Ä–æ—â–µ–Ω–∏–µ'
        ],
        energy: 'medium',
        color: '#5f27cd',
        crystals: ['–ê–º–µ—Ç–∏—Å—Ç', '–î—ã–º—á–∞—Ç—ã–π –∫–≤–∞—Ä—Ü', '–§–ª—é–æ—Ä–∏—Ç', '–ß—ë—Ä–Ω—ã–π —Ç—É—Ä–º–∞–ª–∏–Ω'],
        rituals: ['–†–∏—Ç—É–∞–ª –æ—Ç–ø—É—Å–∫–∞–Ω–∏—è', '–ù–∞–ø–∏—Å–∞–Ω–∏–µ –∏ —Å–∂–∏–≥–∞–Ω–∏–µ —Ç–æ–≥–æ, –æ—Ç —á–µ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç–µ—Å—å', '–û—á–∏—â–µ–Ω–∏–µ –¥–æ–º–∞ —à–∞–ª—Ñ–µ–µ–º', '–ë–∞–Ω—è –∏–ª–∏ –¥–µ—Ç–æ–∫—Å'],
        bestActivities: ['–£–±–æ—Ä–∫–∞ –∏ —Ä–∞—Å—Ö–ª–∞–º–ª–µ–Ω–∏–µ', '–ü—Ä–æ—â–µ–Ω–∏–µ –æ–±–∏–¥', '–û—á–∏—â–∞—é—â–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã', '–ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫'],
        avoid: ['–ù–∞—á–∞–ª–æ –Ω–æ–≤—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π', '–ö—Ä—É–ø–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏', '–°—Ç—Ä–∏–∂–∫–∞ –≤–æ–ª–æ—Å –¥–ª—è —Ä–æ—Å—Ç–∞'],
        affirmation: '–Ø –æ—Ç–ø—É—Å–∫–∞—é –≤—Å—ë, —á—Ç–æ –º–Ω–µ –Ω–µ —Å–ª—É–∂–∏—Ç, —Å –ª—ë–≥–∫–æ—Å—Ç—å—é –∏ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å—é'
      },
      '–ü–æ—Å–ª–µ–¥–Ω—è—è —á–µ—Ç–≤–µ—Ä—Ç—å': {
        tarot: 'üìä –í—Ä–µ–º—è –¥–ª—è —Ä–∞—Å–∫–ª–∞–¥–æ–≤ –Ω–∞ –ø–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤ –∏ —É—Ä–æ–∫–∏',
        general: [
          '–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã',
          '–£—á–∏—Ç–µ—Å—å –Ω–∞ –æ–ø—ã—Ç–µ',
          '–î–µ–ª–∏—Ç–µ—Å—å –º—É–¥—Ä–æ—Å—Ç—å—é',
          '–ì–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –Ω–æ–≤–æ–º—É —Ü–∏–∫–ª—É'
        ],
        energy: 'low-medium',
        color: '#341f97',
        crystals: ['–õ–∞–∑—É—Ä–∏—Ç', '–°–æ–¥–∞–ª–∏—Ç', '–ê–º–µ—Ç–∏—Å—Ç', '–°–∏–Ω–∏–π –ª—ç—Å-–ª—ç–ø–∏—Å'],
        rituals: ['–†–∏—Ç—É–∞–ª –ø–æ–¥–≤–µ–¥–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤', '–ú–µ–¥–∏—Ç–∞—Ü–∏—è –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏', '–ó–∞–ø–∏—Å—å —É—Ä–æ–∫–æ–≤ –º–µ—Å—è—Ü–∞', '–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–µ–ª'],
        bestActivities: ['–†–µ—Ç—Ä–æ—Å–ø–µ–∫—Ç–∏–≤–∞', '–û–±—Å—É–∂–¥–µ–Ω–∏–µ —Å –º–µ–Ω—Ç–æ—Ä–æ–º', '–ó–∞–∫—Ä—ã—Ç–∏–µ –≥–µ—à—Ç–∞–ª—å—Ç–æ–≤', '–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π'],
        avoid: ['–ù–æ–≤—ã–µ –Ω–∞—á–∏–Ω–∞–Ω–∏—è', '–ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏', '–†–∏—Å–∫–∏ –∏ –∞–≤–∞–Ω—Ç—é—Ä—ã'],
        affirmation: '–Ø –∏–∑–≤–ª–µ–∫–∞—é –º—É–¥—Ä–æ—Å—Ç—å –∏–∑ –∫–∞–∂–¥–æ–≥–æ –æ–ø—ã—Ç–∞ –∏ –≥–æ—Ç–æ–≤–ª—é—Å—å –∫ –Ω–æ–≤–æ–º—É —Ü–∏–∫–ª—É'
      },
      '–£–±—ã–≤–∞—é—â–∏–π —Å–µ—Ä–ø': {
        tarot: 'üòå –†–∞—Å–∫–ª–∞–¥—ã –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Ä–∞–±–æ—Ç—É –∏ —Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏–µ',
        general: [
          '–û—Ç–¥—ã—Ö–∞–π—Ç–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ—Å—å',
          '–ú–µ–¥–∏—Ç–∏—Ä—É–π—Ç–µ',
          '–í–µ–¥–∏—Ç–µ –¥–Ω–µ–≤–Ω–∏–∫',
          '–ì–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –Ω–æ–≤–æ–ª—É–Ω–∏—é'
        ],
        energy: 'very-low',
        color: '#0c2461',
        crystals: ['–ß—ë—Ä–Ω—ã–π –æ–±—Å–∏–¥–∏–∞–Ω', '–õ–∞–±—Ä–∞–¥–æ—Ä–∏—Ç', '–ì–∞–≥–∞—Ç', '–®—É–Ω–≥–∏—Ç'],
        rituals: ['–ì–ª—É–±–æ–∫–∞—è –º–µ–¥–∏—Ç–∞—Ü–∏—è', '–°–Ω–æ–≤–∏–¥—á–µ—Å–∫–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏', '–†–∞–±–æ—Ç–∞ —Å —Ç–µ–Ω–µ–≤–æ–π —Å—Ç–æ—Ä–æ–Ω–æ–π', '–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–æ–µ –æ—á–∏—â–µ–Ω–∏–µ'],
        bestActivities: ['–°–æ–Ω –∏ –æ—Ç–¥—ã—Ö', '–ò–Ω—Ç—Ä–æ—Å–ø–µ–∫—Ü–∏—è', '–î—É—Ö–æ–≤–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏', '–ú–æ–ª—á–∞–ª–∏–≤—ã–µ —Ä–µ—Ç—Ä–∏—Ç—ã'],
        avoid: ['–í–∞–∂–Ω—ã–µ –Ω–∞—á–∏–Ω–∞–Ω–∏—è', '–ê–∫—Ç–∏–≤–Ω–∞—è —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –∂–∏–∑–Ω—å', '–§–∏–∑–∏—á–µ—Å–∫–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏', '–ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π'],
        affirmation: '–Ø –æ—Ç–¥—ã—Ö–∞—é, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Å—å –∏ –≥–æ—Ç–æ–≤–ª—é—Å—å –∫ –Ω–æ–≤–æ–º—É –≤–æ–ª—à–µ–±–Ω–æ–º—É —Ü–∏–∫–ª—É'
      }
    };

    return recommendations[phaseName] || recommendations['–ù–æ–≤–æ–ª—É–Ω–∏–µ'];
  }

  /**
   * –ü–æ–ª—É—á–∞–µ—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Ñ–∞–∑ –õ—É–Ω—ã –Ω–∞ –º–µ—Å—è—Ü
   */
  getMonthCalendar(year = new Date().getFullYear(), month = new Date().getMonth()) {
    const calendar = [];
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    for (let day = 1; day <= daysInMonth; day++) {
      const date = new Date(year, month, day);
      const phase = this.calculateMoonPhase(date);

      calendar.push({
        date: day,
        dayOfWeek: date.toLocaleDateString('ru-RU', { weekday: 'short' }),
        phase: phase.phaseName,
        emoji: phase.emoji,
        illumination: phase.illumination,
        isSpecial: ['–ù–æ–≤–æ–ª—É–Ω–∏–µ', '–ü–æ–ª–Ω–æ–ª—É–Ω–∏–µ', '–ü–µ—Ä–≤–∞—è —á–µ—Ç–≤–µ—Ä—Ç—å', '–ü–æ—Å–ª–µ–¥–Ω—è—è —á–µ—Ç–≤–µ—Ä—Ç—å'].includes(phase.phaseName)
      });
    }

    return {
      year,
      month: month + 1,
      monthName: new Date(year, month).toLocaleDateString('ru-RU', { month: 'long' }),
      days: calendar
    };
  }

  /**
   * –ù–∞—Ö–æ–¥–∏—Ç –±–ª–∏–∂–∞–π—à–µ–µ –ø–æ–ª–Ω–æ–ª—É–Ω–∏–µ
   */
  getNextFullMoon(fromDate = new Date()) {
    const date = new Date(fromDate);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ 35 –¥–Ω–µ–π –≤–ø–µ—Ä—ë–¥ (–±–æ–ª—å—à–µ –ª—É–Ω–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞)
    for (let i = 0; i < 35; i++) {
      const phase = this.calculateMoonPhase(date);
      if (phase.phaseName === '–ü–æ–ª–Ω–æ–ª—É–Ω–∏–µ') {
        return {
          date: date.toISOString(),
          dateFormatted: date.toLocaleDateString('ru-RU', {
            day: 'numeric',
            month: 'long',
            year: 'numeric'
          }),
          daysUntil: i,
          phase
        };
      }
      date.setDate(date.getDate() + 1);
    }

    return null;
  }

  /**
   * –ù–∞—Ö–æ–¥–∏—Ç –±–ª–∏–∂–∞–π—à–µ–µ –Ω–æ–≤–æ–ª—É–Ω–∏–µ
   */
  getNextNewMoon(fromDate = new Date()) {
    const date = new Date(fromDate);

    for (let i = 0; i < 35; i++) {
      const phase = this.calculateMoonPhase(date);
      if (phase.phaseName === '–ù–æ–≤–æ–ª—É–Ω–∏–µ') {
        return {
          date: date.toISOString(),
          dateFormatted: date.toLocaleDateString('ru-RU', {
            day: 'numeric',
            month: 'long',
            year: 'numeric'
          }),
          daysUntil: i,
          phase
        };
      }
      date.setDate(date.getDate() + 1);
    }

    return null;
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–º –¥–ª—è —Ä–∞—Å–∫–ª–∞–¥–∞
   */
  isFavorableForReading(date = new Date()) {
    const phase = this.calculateMoonPhase(date);
    const favorablePhases = ['–ü–æ–ª–Ω–æ–ª—É–Ω–∏–µ', '–†–∞—Å—Ç—É—â–∞—è –õ—É–Ω–∞', '–ü–µ—Ä–≤–∞—è —á–µ—Ç–≤–µ—Ä—Ç—å'];

    return {
      isFavorable: favorablePhases.includes(phase.phaseName),
      currentPhase: phase.phaseName,
      emoji: phase.emoji,
      reason: favorablePhases.includes(phase.phaseName)
        ? `${phase.emoji} –û—Ç–ª–∏—á–Ω–æ–µ –≤—Ä–µ–º—è! ${phase.phaseName} —É—Å–∏–ª–∏–≤–∞–µ—Ç –∏–Ω—Ç—É–∏—Ü–∏—é`
        : `${phase.emoji} ${phase.phaseName} - –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Ä–∞—Å–∫–ª–∞–¥, –Ω–æ —ç–Ω–µ—Ä–≥–∏—è –Ω–µ –Ω–∞ –ø–∏–∫–µ`,
      recommendation: phase.recommendations.tarot
    };
  }
}

module.exports = new MoonPhasesService();
