import{u as E,a as I,r as t,b as j,j as e}from"./index-DsT9s-cB.js";import{S as q}from"./SpreadEngine-D0v5GAzH.js";import"./index-mGa97Y4Z.js";const v="https://tarot-a2oi.onrender.com/api";function P(){const k=E(),{token:g}=I(a=>a.auth),[m,w]=t.useState(null),[S,$]=t.useState(!0),[i,N]=t.useState(""),[o,y]=t.useState(""),[l,x]=t.useState(null),[u,f]=t.useState(!1);t.useEffect(()=>{b()},[]);const b=async()=>{try{const a=await j.get(`${v}/spreads/relationship`);w(a.data.data)}catch(a){console.error("Failed to load spread:",a)}finally{$(!1)}},C=async a=>{f(!0);try{const n=(await j.post(`${v}/spreads/relationship/interpret`,{cards:a.map(s=>({name:s.name,cardId:s.cardId,reversed:s.reversed})),question:i,context:{partner:o}},{headers:{Authorization:`Bearer ${g}`}})).data.data,r={summary:n.summary,positions:n.positions.map((s,d)=>{var c,p;return{position:s.positionName,card:s.card.name,reversed:s.card.reversed,keywords:((c=a[d])==null?void 0:c.keywords)||[],arcana:(p=a[d])==null?void 0:p.arcana,meaning:s.interpretation}})};x(r);try{await j.post(`${v}/spreads/relationship/save`,{cards:a,interpretation:r,question:i,context:{partner:o}},{headers:{Authorization:`Bearer ${g}`}})}catch(s){console.error("Failed to save:",s)}}catch(h){console.error("Failed to get interpretation:",h);const n={summary:`Ğ’Ğ°ÑˆĞ¸ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ ${o?`Ñ ${o}`:""} Ñ€Ğ°ÑĞºÑ€Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· ${a.length} ĞºĞ°Ñ€Ñ‚. ${i?`Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ: "${i}"`:""} ĞšĞ°Ñ€Ñ‚Ñ‹ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸ĞºÑƒ, ÑĞ¸Ğ»ÑŒĞ½Ñ‹Ğµ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹ Ğ¸ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚Ğ¸ Ñ€Ğ¾ÑÑ‚Ğ°.`,positions:a.map((r,s)=>{var d,c,p;return{position:((d=m.positions[s])==null?void 0:d.name)||`ĞŸĞ¾Ğ·Ğ¸Ñ†Ğ¸Ñ ${s+1}`,card:r.name,reversed:r.reversed,keywords:r.keywords,arcana:r.arcana,meaning:r.reversed?`ĞŸĞµÑ€ĞµĞ²Ñ‘Ñ€Ğ½ÑƒÑ‚Ğ°Ñ ĞºĞ°Ñ€Ñ‚Ğ° Ğ² Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸ÑÑ…: ${(c=r.keywords)==null?void 0:c.slice(0,2).join(", ")}. Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ Ğ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹.`:`ĞŸÑ€ÑĞ¼Ğ°Ñ ĞºĞ°Ñ€Ñ‚Ğ° Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ°ĞµÑ‚: ${(p=r.keywords)==null?void 0:p.slice(0,2).join(", ")}. ĞŸĞ¾Ğ·Ğ¸Ñ‚Ğ¸Ğ²Ğ½Ğ°Ñ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ Ğ² ÑÑ‚Ğ¾Ğ¼ Ğ°ÑĞ¿ĞµĞºÑ‚Ğµ.`}})};x(n)}finally{f(!1)}};return S?e.jsx("div",{className:"loading",children:"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°..."}):e.jsxs("div",{className:"relationship-spread-page",children:[e.jsxs("header",{className:"reading-header",children:[e.jsx("button",{onClick:()=>k("/dashboard"),className:"btn-back",children:"â† ĞĞ°Ğ·Ğ°Ğ´"}),e.jsx("h1",{children:"ğŸ’• Ğ Ğ°ÑĞºĞ»Ğ°Ğ´ ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğ¹"})]}),e.jsxs("main",{className:"relationship-content",children:[!l&&e.jsxs("div",{className:"question-section",children:[e.jsx("h3",{children:"Ğ Ğ’Ğ°ÑˆĞ¸Ñ… ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸ÑÑ…"}),e.jsx("p",{className:"question-hint",children:"Ğ­Ñ‚Ğ¾Ñ‚ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ½ÑÑ‚ÑŒ Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸ĞºÑƒ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğ¹, ÑĞ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¸ ÑĞ»Ğ°Ğ±Ñ‹Ğµ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹, Ğ¸ ĞºÑƒĞ´Ğ° Ğ¾Ğ½Ğ¸ Ğ´Ğ²Ğ¸Ğ¶ÑƒÑ‚ÑÑ."}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Ğ˜Ğ¼Ñ Ğ¿Ğ°Ñ€Ñ‚Ğ½Ñ‘Ñ€Ğ° (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾):"}),e.jsx("input",{type:"text",value:o,onChange:a=>y(a.target.value),placeholder:"ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: ĞĞ»ĞµĞºÑĞ°Ğ½Ğ´Ñ€",className:"partner-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Ğ’Ğ°Ñˆ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¾Ğ± Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸ÑÑ…:"}),e.jsx("textarea",{value:i,onChange:a=>N(a.target.value),placeholder:"ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: ĞšĞ°ĞºĞ¾Ğ²Ğ¾ Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ Ğ½Ğ°ÑˆĞ¸Ñ… Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğ¹?",className:"question-input",rows:3})]})]}),m&&!l&&!u&&e.jsx(q,{spread:m,onComplete:C}),u&&e.jsxs("div",{className:"interpretation-loading",children:[e.jsx("div",{className:"loading-spinner",children:"ğŸ’•"}),e.jsx("p",{children:"Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ¿Ñ€ĞµÑ‚Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğ¹..."}),e.jsx("p",{className:"loading-hint",children:"ĞšĞ°Ñ€Ñ‚Ñ‹ Ñ€Ğ°ÑĞºÑ€Ñ‹Ğ²Ğ°ÑÑ‚ Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸ĞºÑƒ Ğ²Ğ°ÑˆĞ¸Ñ… Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğ¹..."})]}),l&&!u&&e.jsxs("div",{className:"interpretation-results",children:[e.jsx("h2",{children:"ğŸ’– Ğ˜Ğ½Ñ‚ĞµÑ€Ğ¿Ñ€ĞµÑ‚Ğ°Ñ†Ğ¸Ñ ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğ¹"}),e.jsxs("div",{className:"interpretation-summary",children:[e.jsx("h3",{children:"ĞĞ±Ñ‰Ğ°Ñ ĞšĞ°Ñ€Ñ‚Ğ¸Ğ½Ğ°:"}),e.jsx("p",{children:l.summary})]}),e.jsx("div",{className:"relationship-insights",children:l.positions.map((a,h)=>{var n;return e.jsxs("div",{className:"position-interpretation",children:[e.jsxs("div",{className:"position-header",children:[e.jsx("div",{className:"position-badge",children:a.position}),a.arcana==="major"&&e.jsx("span",{className:"arcana-badge",children:"Ğ¡Ñ‚Ğ°Ñ€ÑˆĞ¸Ğ¹ ĞÑ€ĞºĞ°Ğ½"})]}),e.jsxs("h4",{children:[a.card,a.reversed&&e.jsx("span",{className:"reversed-indicator",children:" âš¡ ĞŸĞµÑ€ĞµĞ²Ñ‘Ñ€Ğ½ÑƒÑ‚Ğ°"})]}),e.jsx("div",{className:"card-keywords-display",children:(n=a.keywords)==null?void 0:n.map((r,s)=>e.jsx("span",{className:"keyword-tag",children:r},s))}),e.jsx("p",{children:a.meaning})]},h)})}),e.jsxs("div",{className:"relationship-advice",children:[e.jsx("h3",{children:"ğŸ’¡ Ğ¡Ğ¾Ğ²ĞµÑ‚:"}),e.jsx("p",{children:"ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ - ÑÑ‚Ğ¾ Ñ‚Ğ°Ğ½ĞµÑ† Ğ´Ğ²ÑƒÑ… Ğ´ÑƒÑˆ. Ğ¢Ğ¾ Ñ‡Ñ‚Ğ¾ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ ĞºĞ°Ñ€Ñ‚Ñ‹ - Ğ½Ğµ Ğ¿Ñ€Ğ¸Ğ³Ğ¾Ğ²Ğ¾Ñ€, Ğ° Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ¸ Ğ´Ğ»Ñ Ñ€Ğ¾ÑÑ‚Ğ°. Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ¹Ñ‚Ğµ Ğ½Ğ°Ğ´ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚ÑĞ¼Ğ¸ Ğ²Ğ¼ĞµÑÑ‚Ğµ."})]}),e.jsx("button",{onClick:()=>{x(null),N(""),y("")},className:"btn-primary",children:"ğŸ”„ ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ Ğ°ÑĞºĞ»Ğ°Ğ´"})]})]})]})}export{P as default};
