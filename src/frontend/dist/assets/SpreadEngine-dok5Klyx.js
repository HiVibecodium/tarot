import{j as e,a as M,r as h,b as I}from"./index-DGG8Ewhi.js";import{P as a}from"./index-yEOvs9YB.js";function $({card:s,size:d="medium",className:x=""}){const g=t=>t==="major"?"‚≠ê":"üé¥",i=t=>({wands:"üî•",cups:"üíß",swords:"‚öîÔ∏è",pentacles:"‚≠ï"})[t]||"üé¥";return s.imageUrl?e.jsxs("div",{className:`tarot-card-image ${d} ${s.reversed?"reversed":""} ${x}`,children:[e.jsx("img",{src:s.imageUrl,alt:s.name}),s.reversed&&e.jsx("div",{className:"reversed-overlay-img",children:"‚ö° –ü–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–∞"})]}):e.jsx("div",{className:`tarot-card-placeholder ${d} ${s.reversed?"reversed":""} ${x}`,children:e.jsxs("div",{className:"card-border",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("span",{className:"arcana-indicator",children:g(s.arcana)}),s.suit&&e.jsx("span",{className:"suit-indicator",children:i(s.suit)})]}),e.jsx("div",{className:"card-name-display",children:s.name}),s.keywords&&s.keywords.length>0&&e.jsx("div",{className:"card-keywords-list",children:s.keywords.slice(0,3).map((t,l)=>e.jsx("span",{className:"kw-tag",children:t},l))}),s.reversed&&e.jsx("div",{className:"reversed-overlay",children:"‚ö° –ü–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–∞"})]})})}$.propTypes={card:a.shape({name:a.string.isRequired,arcana:a.string,suit:a.string,keywords:a.array,reversed:a.bool}).isRequired,size:a.oneOf(["small","medium","large"]),className:a.string};let T=null,u=!1;const v=()=>(T||(T=new(window.AudioContext||window.webkitAudioContext)),T),c=(s,d,x="sine",g=.3)=>{if(u)return;const i=v(),t=i.createOscillator(),l=i.createGain();t.connect(l),l.connect(i.destination),t.frequency.value=s,t.type=x,l.gain.setValueAtTime(g,i.currentTime),l.gain.exponentialRampToValueAtTime(.01,i.currentTime+d),t.start(i.currentTime),t.stop(i.currentTime+d)},U=()=>{if(u)return;v().currentTime,c(523.25,.1,"sine",.2),setTimeout(()=>c(659.25,.1,"sine",.15),50),setTimeout(()=>c(783.99,.15,"sine",.1),100)},L=()=>{if(u)return;v().currentTime,c(440,.08,"triangle",.15),setTimeout(()=>c(554.37,.08,"triangle",.15),60),setTimeout(()=>c(659.25,.2,"triangle",.12),120)},P=()=>{u||(v(),c(523.25,.1,"sine",.2),setTimeout(()=>c(659.25,.1,"sine",.18),100),setTimeout(()=>c(783.99,.1,"sine",.16),200),setTimeout(()=>c(1046.5,.25,"sine",.14),300))},O=()=>(u=!u,u),_=()=>u,z="https://tarot-a2oi.onrender.com/api";function B({spread:s,onComplete:d,className:x=""}){const{token:g}=M(r=>r.auth),[i,t]=h.useState([]),[l,p]=h.useState(!1),[f,b]=h.useState([]),[S,q]=h.useState(!0),[C,k]=h.useState(null),[N,A]=h.useState(!_());h.useEffect(()=>{E()},[]);const E=async()=>{try{const r=await I.get(`${z}/cards`,{headers:g?{Authorization:`Bearer ${g}`}:{}});b(r.data.data||[])}catch(r){console.error("Failed to load cards:",r),b([])}finally{q(!1)}},R=r=>{if(!i.find(n=>n.position===r.id)){if(f.length===0){console.error("No cards available");return}p(!0),U(),setTimeout(()=>{const n=i.map(w=>w.cardId),m=f.filter(w=>!n.includes(w._id));if(m.length===0){console.error("No cards left in deck"),p(!1);return}const o=m[Math.floor(Math.random()*m.length)],j=Math.random()>.7,y={position:r.id,cardId:o._id,name:o.name,imageUrl:o.imageUrl,reversed:j,arcana:o.arcana,keywords:j?o.keywords.reversed:o.keywords.upright};t([...i,y]),k(y),p(!1),L(),setTimeout(()=>k(null),2e3),i.length+1===s.cardCount&&(setTimeout(()=>P(),300),d==null||d([...i,y]))},800)}},D=()=>{t([])};return S?e.jsxs("div",{className:"spread-engine-loading",children:[e.jsx("div",{className:"loading-spinner",children:"üîÆ"}),e.jsx("p",{children:"–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–æ–¥—ã –¢–∞—Ä–æ..."})]}):e.jsxs("div",{className:`spread-engine ${x}`,children:[e.jsxs("div",{className:"spread-header",children:[e.jsx("h2",{children:s.name}),e.jsx("p",{className:"spread-description",children:s.description}),e.jsxs("div",{className:"spread-meta",children:[e.jsxs("span",{className:"spread-cards",children:["üé¥ ",s.cardCount," –∫–∞—Ä—Ç"]}),e.jsxs("span",{className:"spread-time",children:["‚è±Ô∏è ",s.estimatedTime]}),e.jsxs("span",{className:`spread-difficulty ${s.difficulty}`,children:[s.difficulty==="beginner"&&"‚≠ê –ù–∞—á–∞–ª—å–Ω—ã–π",s.difficulty==="intermediate"&&"‚≠ê‚≠ê –°—Ä–µ–¥–Ω–∏–π",s.difficulty==="advanced"&&"‚≠ê‚≠ê‚≠ê –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π"]})]}),e.jsxs("div",{className:"deck-info",children:[e.jsxs("span",{children:["üìö –ö–æ–ª–æ–¥–∞: ",f.length," –∫–∞—Ä—Ç"]}),e.jsx("button",{onClick:()=>{O(),A(!N)},className:"btn-sound-toggle",title:N?"–í—ã–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫":"–í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫",children:N?"üîä":"üîá"})]})]}),e.jsxs("div",{className:"spread-layout",children:[e.jsx("svg",{viewBox:"0 0 100 100",className:"spread-svg",children:s.positions.map(r=>{const n=i.find(m=>m.position===r.id);return e.jsxs("g",{onClick:()=>!n&&R(r),children:[e.jsx("rect",{x:r.x-5,y:r.y-7,width:"10",height:"14",rx:"1",className:`card-slot ${n?"drawn":"empty"} ${l?"drawing":""}`,transform:r.rotation?`rotate(${r.rotation} ${r.x} ${r.y})`:""}),e.jsx("text",{x:r.x,y:r.y+10,textAnchor:"middle",className:"position-label",children:r.id})]},r.id)})}),e.jsx("div",{className:"positions-list",children:s.positions.map(r=>{var o;const n=i.find(j=>j.position===r.id),m=C&&n&&C.position===r.id;return e.jsxs("div",{className:`position-item ${n?"drawn":""} ${m?"just-drawn":""}`,onClick:()=>!n&&R(r),children:[e.jsx("div",{className:"position-number",children:r.id}),e.jsxs("div",{className:"position-info",children:[e.jsx("h4",{children:r.name}),e.jsx("p",{children:r.description}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"card-visual-preview",children:e.jsx($,{card:n,size:"small"})}),e.jsxs("div",{className:"drawn-card-preview",children:[e.jsxs("div",{className:"card-preview-header",children:[e.jsxs("strong",{children:["‚úì ",n.name]}),n.reversed&&e.jsx("span",{className:"reversed-badge",children:"–ü–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–∞"})]}),e.jsx("div",{className:"card-keywords",children:(o=n.keywords)==null?void 0:o.slice(0,3).join(", ")})]})]})]})]},r.id)})})]}),e.jsxs("div",{className:"spread-progress",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${i.length/s.cardCount*100}%`}})}),e.jsxs("div",{className:"progress-text",children:[i.length," –∏–∑ ",s.cardCount," –∫–∞—Ä—Ç –≤—ã—Ç—è–Ω—É—Ç–æ"]})]}),e.jsxs("div",{className:"spread-actions",children:[e.jsx("button",{onClick:D,className:"btn-secondary",children:"üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ"}),i.length===s.cardCount&&e.jsx("button",{onClick:()=>d==null?void 0:d(i),className:"btn-primary",children:"‚ú® –ü–æ–ª—É—á–∏—Ç—å –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é"})]})]})}B.propTypes={spread:a.shape({id:a.string.isRequired,name:a.string.isRequired,description:a.string.isRequired,cardCount:a.number.isRequired,difficulty:a.string.isRequired,estimatedTime:a.string.isRequired,positions:a.arrayOf(a.shape({id:a.number.isRequired,name:a.string.isRequired,description:a.string.isRequired,x:a.number.isRequired,y:a.number.isRequired,rotation:a.number})).isRequired}).isRequired,onComplete:a.func,className:a.string};export{B as S};
