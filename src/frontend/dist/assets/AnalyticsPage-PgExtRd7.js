import{j as a}from"./index-CVF7lLOD.js";import{u as N,r as o}from"./vendor-react-CnWnGStI.js";import{u as v}from"./vendor-redux-BaGAZ_-q.js";import{a as f}from"./vendor-axios-B9ygI19o.js";import{A as g}from"./LoadingSkeletons-CZdT3T9G.js";import{A as S}from"./SEO-B0xZvd-3.js";import"./vendor-sentry-YIXFnBwd.js";function h({data:n,title:d,type:l="bar"}){if(!n||n.length===0)return null;const m=Math.max(...n.map(c=>c.value));return a.jsxs("div",{className:"simple-chart",children:[d&&a.jsx("h3",{className:"chart-title",children:d}),a.jsxs("div",{className:"chart-container",children:[l==="bar"&&a.jsx("div",{className:"bar-chart",children:n.map((c,i)=>a.jsxs("div",{className:"bar-item",children:[a.jsx("div",{className:"bar-wrapper",children:a.jsx("div",{className:"bar-fill",style:{height:`${c.value/m*100}%`},children:a.jsx("span",{className:"bar-value",children:c.value})})}),a.jsx("div",{className:"bar-label",children:c.label})]},i))}),l==="pie"&&a.jsx("div",{className:"pie-chart",children:n.map((c,i)=>a.jsxs("div",{className:"pie-item",children:[a.jsx("div",{className:"pie-color",style:{background:c.color||"#667eea"}}),a.jsx("span",{className:"pie-label",children:c.label}),a.jsx("span",{className:"pie-value",children:c.value})]},i))})]})]})}const A="/api";function T(){const{token:n}=v(e=>e.auth),d=N(),[l,m]=o.useState([]),[c,i]=o.useState(!0);o.useEffect(()=>{j()},[]);const j=async()=>{try{const e=await f.get(`${A}/readings/history?limit=100`,{headers:{Authorization:`Bearer ${n}`}});m(e.data.data.readings||[])}catch(e){console.error("Load readings error:",e)}finally{i(!1)}},b=()=>{const e={};return l.forEach(r=>{var s;(s=r.cards)==null||s.forEach(t=>{const x=t.cardName||t.name;e[x]=(e[x]||0)+1})}),Object.entries(e).sort((r,s)=>s[1]-r[1]).slice(0,10).map(([r,s])=>({label:r,value:s}))},y=()=>{const e={daily:0,decision:0,purchase:0};return l.forEach(r=>{e[r.type]=(e[r.type]||0)+1}),[{label:"Ğ Ğ°ÑĞºĞ»Ğ°Ğ´ Ğ´Ğ½Ñ",value:e.daily,color:"#667eea"},{label:"ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹",value:e.decision,color:"#764ba2"},{label:"ĞŸĞ¾ĞºÑƒĞ¿ĞºĞ¸",value:e.purchase,color:"#f093fb"},{label:"ğŸ´ Ğ Ğ°ÑĞºĞ»Ğ°Ğ´Ñ‹ Ğ¢Ğ°Ñ€Ğ¾",value:e.spread,color:"#27ae60"}].filter(r=>r.value>0)},p=()=>{const e={};l.filter(s=>s.type==="spread").forEach(s=>{const t=s.spreadType||"unknown";e[t]=(e[t]||0)+1});const r={"celtic-cross":"ğŸ”® ĞšĞµĞ»ÑŒÑ‚ÑĞºĞ¸Ğ¹ ĞšÑ€ĞµÑÑ‚",relationship:"ğŸ’• ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ","career-path":"ğŸ’¼ ĞšĞ°Ñ€ÑŒĞµÑ€Ğ°","year-ahead":"ğŸ† Ğ“Ğ¾Ğ´ Ğ’Ğ¿ĞµÑ€Ñ‘Ğ´"};return Object.entries(e).map(([s,t])=>({label:r[s]||s,value:t,color:s==="celtic-cross"?"#667eea":s==="relationship"?"#ff6b9d":s==="career-path"?"#4facfe":s==="year-ahead"?"#fa709a":"#999"}))},u=()=>{const e={};return l.forEach(r=>{const s=new Date(r.createdAt).toLocaleDateString("ru-RU",{month:"short"});e[s]=(e[s]||0)+1}),Object.entries(e).map(([r,s])=>({label:r,value:s}))};return a.jsxs("div",{className:"analytics-page",children:[a.jsx(S,{}),a.jsxs("header",{className:"reading-header",children:[a.jsx("button",{onClick:()=>d("/dashboard"),className:"btn-back",children:"â† ĞĞ°Ğ·Ğ°Ğ´"}),a.jsx("h1",{children:"ğŸ“Š ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° Ğ¸ Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°"})]}),a.jsxs("main",{className:"analytics-content",children:[c&&a.jsx(g,{}),!c&&l.length===0&&a.jsxs("div",{className:"empty-state",children:[a.jsx("p",{children:"ĞŸĞ¾ĞºĞ° Ğ½ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸"}),a.jsx("p",{children:"Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´Ğ¾Ğ²!"})]}),!c&&l.length>0&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"analytics-summary",children:[a.jsxs("div",{className:"summary-card",children:[a.jsx("span",{className:"summary-number",children:l.length}),a.jsx("span",{className:"summary-label",children:"Ğ’ÑĞµĞ³Ğ¾ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´Ğ¾Ğ²"})]}),a.jsxs("div",{className:"summary-card",children:[a.jsx("span",{className:"summary-number",children:new Set(l.flatMap(e=>{var r;return(r=e.cards)==null?void 0:r.map(s=>s.cardId)})).size}),a.jsx("span",{className:"summary-label",children:"Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ñ… ĞºĞ°Ñ€Ñ‚"})]}),a.jsxs("div",{className:"summary-card",children:[a.jsx("span",{className:"summary-number",children:l.filter(e=>e.type==="decision").length}),a.jsx("span",{className:"summary-label",children:"Ğ ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚Ğ¾"})]}),a.jsxs("div",{className:"summary-card highlight",children:[a.jsx("span",{className:"summary-number",children:l.filter(e=>e.type==="spread").length}),a.jsx("span",{className:"summary-label",children:"ğŸ´ Ğ Ğ°ÑĞºĞ»Ğ°Ğ´Ğ¾Ğ² Ğ¢Ğ°Ñ€Ğ¾"})]})]}),l.filter(e=>e.type==="spread").length>0&&a.jsxs("div",{className:"chart-container",children:[a.jsx("h2",{children:"Ğ¢Ğ¸Ğ¿Ñ‹ Ğ Ğ°ÑĞºĞ»Ğ°Ğ´Ğ¾Ğ² Ğ¢Ğ°Ñ€Ğ¾"}),a.jsx("div",{className:"bar-chart",children:p().map((e,r)=>a.jsxs("div",{className:"bar-item",children:[a.jsx("div",{className:"bar-label",children:e.label}),a.jsxs("div",{className:"bar-wrapper",children:[a.jsx("div",{className:"bar-fill",style:{width:`${e.value/Math.max(...p().map(s=>s.value))*100}%`,background:e.color}}),a.jsx("span",{className:"bar-value",children:e.value})]})]},r))})]}),a.jsxs("div",{className:"charts-grid",children:[a.jsx(h,{data:b(),title:"ğŸ“ˆ Ğ¢Ğ¾Ğ¿-10 Ğ¡Ğ°Ğ¼Ñ‹Ñ… Ğ§Ğ°ÑÑ‚Ñ‹Ñ… ĞšĞ°Ñ€Ñ‚",type:"bar"}),a.jsx(h,{data:y(),title:"ğŸ¯ Ğ¢Ğ¸Ğ¿Ñ‹ Ğ Ğ°ÑĞºĞ»Ğ°Ğ´Ğ¾Ğ²",type:"pie"}),u().length>1&&a.jsx(h,{data:u(),title:"ğŸ“… ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾ ĞœĞµÑÑÑ†Ğ°Ğ¼",type:"bar"})]})]})]})]})}export{T as default};
