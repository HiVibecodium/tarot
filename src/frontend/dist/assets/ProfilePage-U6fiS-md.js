import{j as e}from"./index-CVF7lLOD.js";import{r as i,u as J}from"./vendor-react-CnWnGStI.js";import{u as W}from"./vendor-redux-BaGAZ_-q.js";import{a as f}from"./vendor-axios-B9ygI19o.js";import{u as _,T as q}from"./Toast-BRpqxXdk.js";import{A as P,c as T}from"./achievements-BYOhkVaU.js";import{P as F}from"./LoadingSkeletons-CZdT3T9G.js";import{E as V}from"./ErrorDisplay-XrrhJckB.js";import{f as K}from"./SEO-B0xZvd-3.js";import"./vendor-sentry-YIXFnBwd.js";function Y({achievementId:a,unlocked:t=!1,size:r="medium"}){const n=P[a];return n?e.jsxs("div",{className:`achievement-badge ${t?"unlocked":"locked"} size-${r}`,children:[e.jsx("div",{className:"badge-icon",children:n.icon}),e.jsxs("div",{className:"badge-info",children:[e.jsx("div",{className:"badge-name",children:n.name}),r!=="small"&&e.jsx("div",{className:"badge-description",children:n.description})]}),!t&&e.jsx("div",{className:"badge-lock",children:"üîí"})]}):null}const G="";function E(){return"serviceWorker"in navigator&&"PushManager"in window}function H(){return"Notification"in window?Notification.permission:"unsupported"}async function Q(){if(!("Notification"in window))return{success:!1,permission:"unsupported"};try{const a=await Notification.requestPermission();return{success:a==="granted",permission:a}}catch(a){return console.error("Error requesting notification permission:",a),{success:!1,permission:"denied",error:a}}}async function X(){if(!E())return{success:!1,error:"Push not supported"};try{const a=await navigator.serviceWorker.ready;let t=await a.pushManager.getSubscription();return t||(t=await a.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:se(G)})),localStorage.setItem("push-subscription",JSON.stringify(t)),{success:!0,subscription:t}}catch(a){return console.error("Error subscribing to push:",a),{success:!1,error:a.message}}}async function Z(){try{const t=await(await navigator.serviceWorker.ready).pushManager.getSubscription();return t&&(await t.unsubscribe(),localStorage.removeItem("push-subscription")),{success:!0}}catch(a){return console.error("Error unsubscribing:",a),{success:!1,error:a.message}}}async function ee(){if(!E())return!1;try{return!!await(await navigator.serviceWorker.ready).pushManager.getSubscription()}catch{return!1}}function D(a=9,t=0){const r={enabled:!0,hour:a,minute:t,lastShown:null};return localStorage.setItem("daily-reminder",JSON.stringify(r)),r}function B(){const a=localStorage.getItem("daily-reminder");return a?JSON.parse(a):{enabled:!1,hour:9,minute:0,lastShown:null}}function R(){const a=B();a.enabled=!1,localStorage.setItem("daily-reminder",JSON.stringify(a))}function se(a){return new Uint8Array}function ae(){const[a,t]=i.useState("default"),[r,n]=i.useState(!1),[o,c]=i.useState({enabled:!1,hour:9}),[v,m]=i.useState(!1),[j,y]=i.useState(!0);i.useEffect(()=>{y(E()),t(H()),c(B()),ee().then(n)},[]);const S=async()=>{m(!0);const{success:l,permission:d}=await Q();if(t(d),l){const p=await X();n(p.success)}m(!1)},h=async()=>{m(!0),await Z(),n(!1),R(),c({...o,enabled:!1}),m(!1)},b=()=>{if(o.enabled)R(),c({...o,enabled:!1});else{const l=D(o.hour,0);c(l)}},N=l=>{const d=parseInt(l.target.value),p=D(d,0);c(p)};return j?e.jsxs("div",{className:"notification-settings",children:[e.jsxs("h3",{className:"notification-title",children:[e.jsx("span",{className:"notification-icon",children:"üîî"}),"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"]}),a==="denied"?e.jsxs("div",{className:"notification-denied",children:[e.jsx("p",{children:"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞."}),e.jsx("p",{className:"notification-hint",children:"–†–∞–∑—Ä–µ—à–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"notification-toggle-row",children:[e.jsxs("div",{className:"toggle-info",children:[e.jsx("span",{className:"toggle-label",children:"Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"}),e.jsx("span",{className:"toggle-description",children:"–ü–æ–ª—É—á–∞–π—Ç–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ —Ä–∞—Å–∫–ª–∞–¥–∞—Ö"})]}),e.jsx("button",{className:`toggle-button ${r?"active":""}`,onClick:r?h:S,disabled:v,children:v?"...":r?"–í–∫–ª":"–í—ã–∫–ª"})]}),r&&e.jsxs("div",{className:"reminder-settings",children:[e.jsxs("div",{className:"notification-toggle-row",children:[e.jsxs("div",{className:"toggle-info",children:[e.jsx("span",{className:"toggle-label",children:"–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ"}),e.jsx("span",{className:"toggle-description",children:"–ù–∞–ø–æ–º–Ω–∏–º –æ –∫–∞—Ä—Ç–µ –¥–Ω—è"})]}),e.jsx("button",{className:`toggle-button ${o.enabled?"active":""}`,onClick:b,children:o.enabled?"–í–∫–ª":"–í—ã–∫–ª"})]}),o.enabled&&e.jsxs("div",{className:"time-selector",children:[e.jsx("label",{className:"time-label",children:"–í—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:"}),e.jsx("select",{value:o.hour,onChange:N,className:"time-select",children:Array.from({length:24},(l,d)=>e.jsxs("option",{value:d,children:[d.toString().padStart(2,"0"),":00"]},d))})]})]})]})]}):e.jsx("div",{className:"notification-settings",children:e.jsxs("div",{className:"notification-unsupported",children:[e.jsx("span",{className:"notification-icon",children:"üîï"}),e.jsx("p",{children:"Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ"})]})})}const x="/api";function he(){const{token:a}=W(s=>s.auth),t=J(),r=_(),[n,o]=i.useState(null),[c,v]=i.useState(null),[m,j]=i.useState(!1),[y,S]=i.useState(""),[h,b]=i.useState(!0),[N,l]=i.useState(null),[d,p]=i.useState(!1),[w,L]=i.useState([]),[C,A]=i.useState([]);i.useEffect(()=>{k(),I(),O()},[]),i.useEffect(()=>{if(n&&w.length>0){const s=T(n,w);A(s)}},[n,w]);const k=async()=>{try{l(null);const s=await f.get(`${x}/users/profile`,{headers:{Authorization:`Bearer ${a}`}});o(s.data.data.user),S(s.data.data.user.displayName||"")}catch(s){console.error("Load profile error:",s),l(s)}},I=async()=>{try{const s=await f.get(`${x}/users/stats`,{headers:{Authorization:`Bearer ${a}`}});v(s.data.data.stats)}catch(s){console.error("Load stats error:",s)}finally{b(!1)}},O=async()=>{try{const s=await f.get(`${x}/readings/history?limit=100`,{headers:{Authorization:`Bearer ${a}`}});L(s.data.data.readings||[]);const g=T(s.data.data.readings||[],c);A(g)}catch(s){console.error("Load readings error:",s)}},z=async()=>{b(!0);try{await f.put(`${x}/users/profile`,{displayName:y},{headers:{Authorization:`Bearer ${a}`}}),await k(),j(!1),r.success("–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!")}catch(s){console.error("Update profile error:",s),r.error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")}finally{b(!1)}},U=async()=>{try{const s=await f.get(`${x}/users/export`,{headers:{Authorization:`Bearer ${a}`},responseType:"blob"}),g=window.URL.createObjectURL(new Blob([s.data])),u=document.createElement("a");u.href=g,u.setAttribute("download",`tarot-data-${Date.now()}.json`),document.body.appendChild(u),u.click(),u.remove(),r.success("–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!")}catch(s){console.error("Export error:",s),r.error("–ù–µ —É–¥–∞–ª–æ—Å—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")}},M=async()=>{var s,g,u;try{await f.delete(`${x}/users/account`,{headers:{Authorization:`Bearer ${a}`},data:{confirmation:"DELETE MY ACCOUNT"}}),r.success("–ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω"),setTimeout(()=>{localStorage.clear(),t("/register")},1500)}catch($){console.error("Delete account error:",$),r.error(((u=(g=(s=$.response)==null?void 0:s.data)==null?void 0:g.error)==null?void 0:u.message)||"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç")}};return n?e.jsxs("div",{className:"profile-page",children:[e.jsx(K,{}),r.toasts.map(s=>e.jsx(q,{message:s.message,type:s.type,duration:s.duration,onClose:()=>r.hideToast(s.id)},s.id)),e.jsxs("header",{className:"reading-header",children:[e.jsx("button",{onClick:()=>t("/dashboard"),className:"btn-back",children:"‚Üê –ù–∞–∑–∞–¥"}),e.jsx("h1",{children:"üë§ –ü—Ä–æ—Ñ–∏–ª—å –∏ –ù–∞—Å—Ç—Ä–æ–π–∫–∏"})]}),e.jsxs("main",{className:"profile-content",children:[h&&e.jsx(F,{}),N&&e.jsx(V,{error:N,onRetry:k,context:{page:"profile"}}),!h&&!N&&n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"profile-card",children:[e.jsx("h2",{children:"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ü—Ä–æ—Ñ–∏–ª—è"}),e.jsxs("div",{className:"profile-field",children:[e.jsx("label",{children:"–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞"}),e.jsx("div",{className:"field-value",children:n.email})]}),e.jsxs("div",{className:"profile-field",children:[e.jsx("label",{children:"–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –ò–º—è"}),m?e.jsx("input",{type:"text",value:y,onChange:s=>S(s.target.value),placeholder:"–í–∞—à–µ –∏–º—è"}):e.jsx("div",{className:"field-value",children:n.displayName||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"})]}),e.jsxs("div",{className:"profile-field",children:[e.jsx("label",{children:"–ü–æ–¥–ø–∏—Å–∫–∞"}),e.jsx("div",{className:"field-value",children:e.jsx("span",{className:`tier-badge ${n.subscriptionTier}`,children:n.subscriptionTier==="premium"?"–ü—Ä–µ–º–∏—É–º":"–ë–µ—Å–ø–ª–∞—Ç–Ω–æ"})})]}),m?e.jsxs("div",{className:"button-group",children:[e.jsx("button",{onClick:z,className:"btn-primary",disabled:h,children:h?"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...":"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"}),e.jsx("button",{onClick:()=>j(!1),className:"btn-secondary",children:"–û—Ç–º–µ–Ω–∞"})]}):e.jsx("button",{onClick:()=>j(!0),className:"btn-primary",children:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ü—Ä–æ—Ñ–∏–ª—å"})]}),c&&e.jsxs("div",{className:"profile-card",children:[e.jsx("h2",{children:"–í–∞—à–∞ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"}),e.jsxs("div",{className:"stats-grid-detailed",children:[e.jsxs("div",{className:"stat-box",children:[e.jsx("span",{className:"stat-icon",children:"üìä"}),e.jsx("span",{className:"stat-number",children:c.readings.total}),e.jsx("span",{className:"stat-label",children:"–í—Å–µ–≥–æ –†–∞—Å–∫–ª–∞–¥–æ–≤"})]}),e.jsxs("div",{className:"stat-box",children:[e.jsx("span",{className:"stat-icon",children:"üî•"}),e.jsx("span",{className:"stat-number",children:c.streaks.current}),e.jsx("span",{className:"stat-label",children:"–¢–µ–∫—É—â–∞—è –°–µ—Ä–∏—è"})]}),e.jsxs("div",{className:"stat-box",children:[e.jsx("span",{className:"stat-icon",children:"üèÜ"}),e.jsx("span",{className:"stat-number",children:c.streaks.longest}),e.jsx("span",{className:"stat-label",children:"–õ—É—á—à–∞—è –°–µ—Ä–∏—è"})]}),e.jsxs("div",{className:"stat-box",children:[e.jsx("span",{className:"stat-icon",children:"üéØ"}),e.jsx("span",{className:"stat-number",children:c.readings.decisions}),e.jsx("span",{className:"stat-label",children:"–†–µ—à–µ–Ω–∏–π –ü—Ä–∏–Ω—è—Ç–æ"})]})]})]}),e.jsx(ae,{}),e.jsxs("div",{className:"profile-card",children:[e.jsx("h2",{children:"üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è"}),e.jsxs("p",{style:{color:"#666",marginBottom:"16px",fontSize:"14px"},children:["–ü–æ–ª—É—á–µ–Ω–æ: ",C.length," –∏–∑ ",Object.keys(P).length]}),e.jsx("div",{className:"achievements-grid",children:Object.keys(P).map(s=>e.jsx(Y,{achievementId:s,unlocked:C.includes(s),size:"medium"},s))})]}),e.jsxs("div",{className:"profile-card gdpr-section",children:[e.jsx("h2",{children:"–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –∏ –î–∞–Ω–Ω—ã–µ"}),e.jsxs("div",{className:"gdpr-actions",children:[e.jsxs("div",{className:"gdpr-item",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"–≠–∫—Å–ø–æ—Ä—Ç –í–∞—à–∏—Ö –î–∞–Ω–Ω—ã—Ö"}),e.jsx("p",{children:"–°–∫–∞—á–∞—Ç—å –≤—Å–µ –≤–∞—à–∏ —Ä–∞—Å–∫–ª–∞–¥—ã –∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è (GDPR)"})]}),e.jsx("button",{onClick:U,className:"btn-secondary",children:"üì• –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –î–∞–Ω–Ω—ã–µ"})]}),e.jsxs("div",{className:"gdpr-item danger-zone",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"–£–¥–∞–ª–∏—Ç—å –ê–∫–∫–∞—É–Ω—Ç"}),e.jsx("p",{children:"–ù–∞–≤—Å–µ–≥–¥–∞ —É–¥–∞–ª–∏—Ç—å –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç –∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ"})]}),d?e.jsxs("div",{className:"delete-confirm",children:[e.jsx("p",{className:"warning-text",children:"‚ö†Ô∏è –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!"}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{onClick:M,className:"btn-danger",children:"–î–∞, –£–¥–∞–ª–∏—Ç—å"}),e.jsx("button",{onClick:()=>p(!1),className:"btn-secondary",children:"–û—Ç–º–µ–Ω–∞"})]})]}):e.jsx("button",{onClick:()=>p(!0),className:"btn-danger",children:"–£–¥–∞–ª–∏—Ç—å –ê–∫–∫–∞—É–Ω—Ç"})]})]})]})]})]})]}):e.jsx("div",{className:"loading",children:"Loading..."})}export{he as default};
