import{j as e,a as I,r as u,b as U}from"./index-h2Dp6_nX.js";import{P as a}from"./index-CqSO3RIi.js";function q({card:s,size:d="medium",className:x=""}){const f=i=>i==="major"?"‚≠ê":"üé¥",t=i=>({wands:"üî•",cups:"üíß",swords:"‚öîÔ∏è",pentacles:"‚≠ï"})[i]||"üé¥";return s.imageUrl?e.jsxs("div",{className:`tarot-card-image ${d} ${s.reversed?"reversed":""} ${x}`,children:[e.jsx("img",{src:s.imageUrl,alt:s.name}),s.reversed&&e.jsx("div",{className:"reversed-overlay-img",children:"‚ö° –ü–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–∞"})]}):e.jsx("div",{className:`tarot-card-placeholder ${d} ${s.reversed?"reversed":""} ${x}`,children:e.jsxs("div",{className:"card-border",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("span",{className:"arcana-indicator",children:f(s.arcana)}),s.suit&&e.jsx("span",{className:"suit-indicator",children:t(s.suit)})]}),e.jsx("div",{className:"card-name-display",children:s.name}),s.keywords&&s.keywords.length>0&&e.jsx("div",{className:"card-keywords-list",children:s.keywords.slice(0,3).map((i,c)=>e.jsx("span",{className:"kw-tag",children:i},c))}),s.reversed&&e.jsx("div",{className:"reversed-overlay",children:"‚ö° –ü–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–∞"})]})})}q.propTypes={card:a.shape({name:a.string.isRequired,arcana:a.string,suit:a.string,keywords:a.array,reversed:a.bool}).isRequired,size:a.oneOf(["small","medium","large"]),className:a.string};let b=null,m=!1;const y=()=>(b||(b=new(window.AudioContext||window.webkitAudioContext)),b),o=(s,d,x="sine",f=.3)=>{if(m)return;const t=y(),i=t.createOscillator(),c=t.createGain();i.connect(c),c.connect(t.destination),i.frequency.value=s,i.type=x,c.gain.setValueAtTime(f,t.currentTime),c.gain.exponentialRampToValueAtTime(.01,t.currentTime+d),i.start(t.currentTime),i.stop(t.currentTime+d)},L=()=>{m||(y(),o(523.25,.1,"sine",.2),setTimeout(()=>o(659.25,.1,"sine",.15),50),setTimeout(()=>o(783.99,.15,"sine",.1),100))},P=()=>{m||(y(),o(440,.08,"triangle",.15),setTimeout(()=>o(554.37,.08,"triangle",.15),60),setTimeout(()=>o(659.25,.2,"triangle",.12),120))},_=()=>{m||(y(),o(523.25,.1,"sine",.2),setTimeout(()=>o(659.25,.1,"sine",.18),100),setTimeout(()=>o(783.99,.1,"sine",.16),200),setTimeout(()=>o(1046.5,.25,"sine",.14),300))},z=()=>(m=!m,m),B=()=>m,F="/api";function V({spread:s,onComplete:d,className:x=""}){const{token:f}=I(r=>r.auth),[t,i]=u.useState([]),[c,v]=u.useState(!1),[N,T]=u.useState([]),[O,A]=u.useState(!0),[R,k]=u.useState(null),[w,E]=u.useState(!B()),j=u.useRef([]);u.useEffect(()=>(G(),()=>{j.current.forEach(r=>clearTimeout(r)),j.current=[]}),[]);const G=async()=>{try{const r=await U.get(`${F}/cards`,{headers:f?{Authorization:`Bearer ${f}`}:{}});T(r.data.data||[])}catch(r){console.error("Failed to load cards:",r),T([])}finally{A(!1)}},$=r=>{if(t.find(p=>p.position===r.id))return;if(N.length===0){console.error("No cards available");return}v(!0),L();const n=setTimeout(()=>{const p=t.map(g=>g.cardId),h=N.filter(g=>!p.includes(g._id));if(h.length===0){console.error("No cards left in deck"),v(!1);return}const l=h[Math.floor(Math.random()*h.length)],S=Math.random()>.7,C={position:r.id,cardId:l._id,name:l.name,imageUrl:l.imageUrl,reversed:S,arcana:l.arcana,keywords:S?l.keywords.reversed:l.keywords.upright};i([...t,C]),k(C),v(!1),P();const M=setTimeout(()=>k(null),2e3);if(j.current.push(M),t.length+1===s.cardCount){const g=setTimeout(()=>_(),300);j.current.push(g),d==null||d([...t,C])}},800);j.current.push(n)},D=()=>{i([])};return O?e.jsxs("div",{className:"spread-engine-loading",children:[e.jsx("div",{className:"loading-spinner",children:"üîÆ"}),e.jsx("p",{children:"–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–æ–¥—ã –¢–∞—Ä–æ..."})]}):e.jsxs("div",{className:`spread-engine ${x}`,children:[e.jsxs("div",{className:"spread-header",children:[e.jsx("h2",{children:s.name}),e.jsx("p",{className:"spread-description",children:s.description}),e.jsxs("div",{className:"spread-meta",children:[e.jsxs("span",{className:"spread-cards",children:["üé¥ ",s.cardCount," –∫–∞—Ä—Ç"]}),e.jsxs("span",{className:"spread-time",children:["‚è±Ô∏è ",s.estimatedTime]}),e.jsxs("span",{className:`spread-difficulty ${s.difficulty}`,children:[s.difficulty==="beginner"&&"‚≠ê –ù–∞—á–∞–ª—å–Ω—ã–π",s.difficulty==="intermediate"&&"‚≠ê‚≠ê –°—Ä–µ–¥–Ω–∏–π",s.difficulty==="advanced"&&"‚≠ê‚≠ê‚≠ê –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π"]})]}),e.jsxs("div",{className:"deck-info",children:[e.jsxs("span",{children:["üìö –ö–æ–ª–æ–¥–∞: ",N.length," –∫–∞—Ä—Ç"]}),e.jsx("button",{onClick:()=>{z(),E(!w)},className:"btn-sound-toggle",title:w?"–í—ã–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫":"–í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫",children:w?"üîä":"üîá"})]})]}),e.jsxs("div",{className:"spread-layout",children:[e.jsxs("svg",{viewBox:"0 0 100 100",className:"spread-svg",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"cardGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#667eea",stopOpacity:"0.8"}),e.jsx("stop",{offset:"50%",stopColor:"#764ba2",stopOpacity:"0.8"}),e.jsx("stop",{offset:"100%",stopColor:"#667eea",stopOpacity:"0.8"})]}),e.jsxs("linearGradient",{id:"hoverGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#ffd700",stopOpacity:"1",children:e.jsx("animate",{attributeName:"stopColor",values:"#ffd700;#ffed4e;#ffd700",dur:"2s",repeatCount:"indefinite"})}),e.jsx("stop",{offset:"50%",stopColor:"#ffed4e",stopOpacity:"1"}),e.jsx("stop",{offset:"100%",stopColor:"#ffd700",stopOpacity:"1",children:e.jsx("animate",{attributeName:"stopColor",values:"#ffd700;#ffed4e;#ffd700",dur:"2s",repeatCount:"indefinite"})})]}),e.jsxs("linearGradient",{id:"drawnGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#e8f5e9",stopOpacity:"0.9"}),e.jsx("stop",{offset:"50%",stopColor:"#c8e6c9",stopOpacity:"0.9"}),e.jsx("stop",{offset:"100%",stopColor:"#a5d6a7",stopOpacity:"0.9"})]}),e.jsxs("linearGradient",{id:"successGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#27ae60",stopOpacity:"1"}),e.jsx("stop",{offset:"50%",stopColor:"#2ecc71",stopOpacity:"1"}),e.jsx("stop",{offset:"100%",stopColor:"#27ae60",stopOpacity:"1"})]})]}),s.positions.map(r=>{const n=t.find(p=>p.position===r.id);return e.jsxs("g",{onClick:()=>!n&&$(r),children:[e.jsx("rect",{x:r.x-5,y:r.y-7,width:"10",height:"14",rx:"1",className:`card-slot ${n?"drawn":"empty"} ${c?"drawing":""}`,transform:r.rotation?`rotate(${r.rotation} ${r.x} ${r.y})`:""}),e.jsx("text",{x:r.x,y:r.y+10,textAnchor:"middle",className:"position-label",children:r.id})]},r.id)})]}),e.jsx("div",{className:"positions-list",children:s.positions.map(r=>{var h;const n=t.find(l=>l.position===r.id),p=R&&n&&R.position===r.id;return e.jsxs("div",{className:`position-item ${n?"drawn":""} ${p?"just-drawn":""}`,onClick:()=>!n&&$(r),children:[e.jsx("div",{className:"position-number",children:r.id}),e.jsxs("div",{className:"position-info",children:[e.jsx("h4",{children:r.name}),e.jsx("p",{children:r.description}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"card-visual-preview",children:e.jsx(q,{card:n,size:"small"})}),e.jsxs("div",{className:"drawn-card-preview",children:[e.jsxs("div",{className:"card-preview-header",children:[e.jsxs("strong",{children:["‚úì ",n.name]}),n.reversed&&e.jsx("span",{className:"reversed-badge",children:"–ü–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–∞"})]}),e.jsx("div",{className:"card-keywords",children:(h=n.keywords)==null?void 0:h.slice(0,3).join(", ")})]})]})]})]},r.id)})})]}),e.jsxs("div",{className:"spread-progress",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${t.length/s.cardCount*100}%`}})}),e.jsxs("div",{className:"progress-text",children:[t.length," –∏–∑ ",s.cardCount," –∫–∞—Ä—Ç –≤—ã—Ç—è–Ω—É—Ç–æ"]})]}),e.jsxs("div",{className:"spread-actions",children:[e.jsx("button",{onClick:D,className:"btn-secondary",children:"üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ"}),t.length===s.cardCount&&e.jsx("button",{onClick:()=>d==null?void 0:d(t),className:"btn-primary",children:"‚ú® –ü–æ–ª—É—á–∏—Ç—å –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é"})]})]})}V.propTypes={spread:a.shape({id:a.string.isRequired,name:a.string.isRequired,description:a.string.isRequired,cardCount:a.number.isRequired,difficulty:a.string.isRequired,estimatedTime:a.string.isRequired,positions:a.arrayOf(a.shape({id:a.number.isRequired,name:a.string.isRequired,description:a.string.isRequired,x:a.number.isRequired,y:a.number.isRequired,rotation:a.number})).isRequired}).isRequired,onComplete:a.func,className:a.string};export{V as S};
