import{j as e,a as E}from"./index-CVF7lLOD.js";import{u as L,r as t}from"./vendor-react-CnWnGStI.js";import{u as R}from"./vendor-redux-BaGAZ_-q.js";import{T as I}from"./TarotCard-BGtKE0RI.js";import{T as P}from"./LoadingSkeletons-CZdT3T9G.js";import{E as _}from"./ErrorDisplay-XrrhJckB.js";import{D}from"./SEO-B0xZvd-3.js";import"./vendor-axios-B9ygI19o.js";import"./vendor-sentry-YIXFnBwd.js";function V(){var S,O;const{token:g}=R(s=>s.auth),u=L();t.useEffect(()=>{g||u("/login",{state:{from:"/decision",message:"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å"}})},[g,u]);const[d,c]=t.useState("input"),[m,w]=t.useState(""),[n,p]=t.useState(["",""]),[o,y]=t.useState(null),[h,k]=t.useState(!1),[x,j]=t.useState(null),[i,N]=t.useState({chosenOption:"",wasHelpful:null,notes:""}),[b,C]=t.useState(0),q=(s,a)=>{const r=[...n];r[s]=a,p(r)},$=()=>{n.length<3&&p([...n,""])},H=s=>{if(n.length>2){const a=n.filter((r,v)=>v!==s);p(a)}},T=async s=>{var a,r,v;s.preventDefault(),c("drawing"),C(0);for(let l=1;l<=3;l++)await new Promise(f=>setTimeout(f,800)),C(l);k(!0),j(null);try{const l=await E.post("/readings/decision",{question:m,options:n.filter(f=>f.trim()!=="")});y(l.data.data.reading),c("result")}catch(l){console.error("Error generating decision:",l),j(((v=(r=(a=l.response)==null?void 0:a.data)==null?void 0:r.error)==null?void 0:v.message)||"Failed to generate decision analysis"),c("input")}finally{k(!1)}},F=()=>{c("input"),w(""),p(["",""]),y(null),j(null)};return g?e.jsxs("div",{className:"decision-page",children:[e.jsx(D,{}),e.jsxs("header",{className:"reading-header",children:[e.jsx("button",{onClick:()=>u("/dashboard"),className:"btn-back",children:"‚Üê –ù–∞–∑–∞–¥"}),e.jsx("h1",{children:"üéØ –ê–Ω–∞–ª–∏–∑ –†–µ—à–µ–Ω–∏—è"})]}),e.jsxs("main",{className:"decision-content",children:[x&&e.jsx(_,{error:x,onRetry:()=>j(null)}),d==="drawing"&&h&&e.jsx(P,{}),d==="drawing"&&!h&&e.jsxs("div",{className:"three-card-drawing",children:[e.jsxs("div",{className:"drawing-title",children:[e.jsx("h2",{children:"–í—ã—Ç—è–≥–∏–≤–∞–µ–º –∫–∞—Ä—Ç—ã –¥–ª—è –≤–∞—à–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è..."}),e.jsxs("p",{className:"decision-question-small",children:['"',m,'"']})]}),e.jsxs("div",{className:"three-cards-animation",children:[e.jsxs("div",{className:`card-position ${b>=1?"drawn":""}`,children:[e.jsx("div",{className:"card-back-draw",children:"üîÆ"}),e.jsx("span",{className:"position-label",children:"–ü—Ä–æ—à–ª–æ–µ"})]}),e.jsxs("div",{className:`card-position ${b>=2?"drawn":""}`,children:[e.jsx("div",{className:"card-back-draw",children:"üîÆ"}),e.jsx("span",{className:"position-label",children:"–ù–∞—Å—Ç–æ—è—â–µ–µ"})]}),e.jsxs("div",{className:`card-position ${b>=3?"drawn":""}`,children:[e.jsx("div",{className:"card-back-draw",children:"üîÆ"}),e.jsx("span",{className:"position-label",children:"–ë—É–¥—É—â–µ–µ"})]})]}),h&&e.jsxs("div",{className:"loading-text",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("p",{children:"–§–æ—Ä–º–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é..."})]})]}),d==="input"&&e.jsx("div",{className:"decision-input",children:e.jsxs("div",{className:"input-card",children:[e.jsx("h2",{children:"–ö–∞–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≤—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ?"}),e.jsx("p",{className:"subtitle",children:"–ü–æ–ª—É—á–∏—Ç–µ —Å–æ–≤–µ—Ç —á–µ—Ä–µ–∑ —Ä–∞—Å–∫–ª–∞–¥ –Ω–∞ 3 –∫–∞—Ä—Ç—ã"}),e.jsxs("form",{onSubmit:T,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"question",children:"–í–∞—à –í–æ–ø—Ä–æ—Å –∏–ª–∏ –†–µ—à–µ–Ω–∏–µ:"}),e.jsx("textarea",{id:"question",value:m,onChange:s=>w(s.target.value),placeholder:"–ù–∞–ø—Ä–∏–º–µ—Ä: –°—Ç–æ–∏—Ç –ª–∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ —Ä–∞–±–æ—Ç–µ?",rows:3,required:!0,maxLength:200}),e.jsxs("span",{className:"char-count",children:[m.length,"/200"]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"–í–∞—Ä–∏–∞–Ω—Ç—ã (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):"}),n.map((s,a)=>e.jsxs("div",{className:"option-input",children:[e.jsx("input",{type:"text",value:s,onChange:r=>q(a,r.target.value),placeholder:`–í–∞—Ä–∏–∞–Ω—Ç ${a+1}`,maxLength:100}),n.length>2&&e.jsx("button",{type:"button",onClick:()=>H(a),className:"btn-remove",children:"√ó"})]},a)),n.length<3&&e.jsx("button",{type:"button",onClick:$,className:"btn-add-option",children:"+ –î–æ–±–∞–≤–∏—Ç—å –í–∞—Ä–∏–∞–Ω—Ç"})]}),x&&e.jsx("div",{className:"error-message",children:x}),e.jsx("button",{type:"submit",className:"btn-primary btn-submit",disabled:h||!m.trim(),children:h?"–í—ã—Ç—è–≥–∏–≤–∞–µ–º –∫–∞—Ä—Ç—ã...":"üîÆ –ü–æ–ª—É—á–∏—Ç—å –°–æ–≤–µ—Ç"})]})]})}),d==="result"&&o&&e.jsxs("div",{className:"decision-result",children:[e.jsxs("div",{className:"result-header",children:[e.jsx("h2",{children:"–ê–Ω–∞–ª–∏–∑ –í–∞—à–µ–≥–æ –†–µ—à–µ–Ω–∏—è"}),e.jsxs("p",{className:"decision-question",children:['"',o.context.question,'"']})]}),e.jsx("div",{className:"cards-spread",children:o.cards.map((s,a)=>e.jsxs("div",{className:"spread-card",children:[e.jsx("div",{className:"position-label",children:s.positionName}),e.jsx(I,{card:{...s,name:s.cardName,keywords:s.keywords,interpretation:s.interpretation},reversed:s.reversed,showInterpretation:!1}),e.jsx("div",{className:"card-meaning",children:e.jsx("p",{children:s.interpretation})})]},a))}),e.jsxs("div",{className:"combined-analysis",children:[e.jsx("h3",{children:"–û–±—â–∏–π –ê–Ω–∞–ª–∏–∑"}),e.jsx("div",{className:"analysis-text",children:e.jsx("p",{style:{whiteSpace:"pre-line"},children:o.interpretation.text})})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:()=>c("outcome"),className:"btn-secondary",children:"üìù –ó–∞–ø–∏—Å–∞—Ç—å –†–µ–∑—É–ª—å—Ç–∞—Ç"}),e.jsx("button",{onClick:F,className:"btn-primary",children:"–ù–æ–≤—ã–π –ê–Ω–∞–ª–∏–∑"}),e.jsx("button",{onClick:()=>u("/dashboard"),className:"btn-secondary",children:"–ù–∞–∑–∞–¥"})]})]}),d==="outcome"&&o&&e.jsxs("div",{className:"outcome-tracking",children:[e.jsx("h2",{children:"üìù –ó–∞–ø–∏—à–∏—Ç–µ –†–µ–∑—É–ª—å—Ç–∞—Ç"}),e.jsx("p",{children:"–ß—Ç–æ –≤—ã —Ä–µ—à–∏–ª–∏ –ø–æ—Å–ª–µ —Ä–∞—Å–∫–ª–∞–¥–∞?"}),e.jsxs("div",{className:"outcome-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"–ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –≤—ã–±—Ä–∞–ª–∏?"}),e.jsxs("select",{value:i.chosenOption,onChange:s=>N({...i,chosenOption:s.target.value}),children:[e.jsx("option",{value:"",children:"–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç"}),(O=(S=o.context)==null?void 0:S.options)==null?void 0:O.map((s,a)=>e.jsx("option",{value:s,children:s},a)),e.jsx("option",{value:"other",children:"–î—Ä—É–≥–æ–µ —Ä–µ—à–µ–Ω–∏–µ"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"–ë—ã–ª –ª–∏ —Ä–∞—Å–∫–ª–∞–¥ –ø–æ–ª–µ–∑–µ–Ω?"}),e.jsxs("div",{className:"rating-buttons",children:[e.jsx("button",{className:`rating-btn ${i.wasHelpful===!0?"active":""}`,onClick:()=>N({...i,wasHelpful:!0}),children:"üëç –î–∞"}),e.jsx("button",{className:`rating-btn ${i.wasHelpful===!1?"active":""}`,onClick:()=>N({...i,wasHelpful:!1}),children:"üëé –ù–µ—Ç"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"–ó–∞–º–µ—Ç–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"}),e.jsx("textarea",{value:i.notes,onChange:s=>N({...i,notes:s.target.value}),placeholder:"–ö–∞–∫ –≤—Å—ë –ø—Ä–æ—à–ª–æ? –ß—Ç–æ –ø–æ–º–æ–≥–ª–æ?",rows:4,maxLength:500})]}),e.jsxs("div",{className:"outcome-actions",children:[e.jsx("button",{onClick:async()=>{try{await E.put(`/readings/${o._id}/feedback`,{userFeedback:i}),alert("‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω!"),c("result")}catch{alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è")}},className:"btn-primary",children:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"}),e.jsx("button",{onClick:()=>c("result"),className:"btn-secondary",children:"–û—Ç–º–µ–Ω–∞"})]})]})]})]})]}):null}export{V as default};
