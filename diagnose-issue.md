# ДИАГНОСТИКА ОШИБКИ "Ошибка сервера" при расладе дня

## Проблема
При попытке вытянуть карту дня выходит ошибка: "Ошибка сервера - Что-то пошло не так"

## Тест показал
Генерация daily reading РАБОТАЕТ правильно (test-daily-reading.js прошел успешно)

## Возможные причины

### 1. Проблемы с аутентификацией ⭐ НАИБОЛЕЕ ВЕРОЯТНО
**Симптомы:**
- Токен истек
- Токен не передается в запросе
- JWT_SECRET не совпадает

**Как проверить:**
1. Откройте DevTools (F12) в браузере
2. Перейдите на вкладку Network
3. Попробуйте вытянуть карту
4. Посмотрите на запрос `/api/readings/daily`
5. Проверьте:
   - Status Code (должен быть 201, а не 401 или 500)
   - Request Headers - есть ли `Authorization: Bearer ...`
   - Response - какая ошибка возвращается

**Решение:**
- Попробуйте выйти и снова войти в систему
- Очистите localStorage: `localStorage.clear()` в консоли браузера
- Повторите вход

### 2. Сервер не запущен
**Как проверить:**
```bash
curl http://localhost:4000/health
```

**Решение:**
```bash
npm start
# или
NODE_ENV=production node src/backend/index-json.js
```

### 3. CORS проблемы
**Симптомы:**
- В консоли браузера ошибка CORS
- Запрос блокируется до отправки

**Решение:**
- Убедитесь что VITE_API_URL правильный в .env файле frontend
- Проверьте CORS_ORIGIN в backend .env

### 4. Проблема с данными пользователя
**Симптомы:**
- У пользователя нет поля `stats`
- `stats.totalReadings` undefined

**Как проверить:**
Посмотрите в src/backend/db/data/users.json вашего пользователя

**Решение:**
Добавьте недостающие поля через Profile page

## Быстрая проверка

### Шаг 1: Проверьте сервер
```bash
curl http://localhost:4000/health
```

Должен вернуть JSON с `"success": true`

### Шаг 2: Попробуйте логин
```bash
curl -X POST http://localhost:4000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"test123"}'
```

Должен вернуть token

### Шаг 3: Попробуйте daily reading с токеном
```bash
TOKEN="ваш_токен_из_шага_2"
curl -X POST http://localhost:4000/api/readings/daily \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{}'
```

Должен вернуть reading

## Что делать ПРЯМО СЕЙЧАС

1. Откройте браузер
2. Нажмите F12 (DevTools)
3. Перейдите на вкладку Console
4. Попробуйте вытянуть карту
5. Скопируйте все красные ошибки и покажите мне

ИЛИ

1. Перейдите на вкладку Network в DevTools
2. Попробуйте вытянуть карту
3. Найдите запрос `daily`
4. Кликните на него
5. Посмотрите Response - покажите мне JSON ответ

## Лог файлы

Если запускали сервер через terminal, посмотрите последние строки вывода - там должна быть ошибка.
